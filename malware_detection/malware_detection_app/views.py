from django.shortcuts import render
from django.contrib.auth.decorators import login_required
from malware_detection_app.collab_code import tarama
from malware_detection_app.file_analyzer import analyze_metrics
from malware_detection_app.file_checker import checkFile
from django.http import HttpResponse
import os
from django.conf import settings

@login_required
def index(request):
    return render(request,"index.html")

@login_required
def port_scanning(request):
    if request.method =="POST":
        host = request.POST.get("host") 
        result = tarama(host)
        # print("Result",result)
        return render(request,"port_scanning.html",{"result":result})
    return render(request,"port_scanning.html")

@login_required
def malware_detection(request):
    return render(request,"malware_detection.html")

@login_required
def how_to_secure_ports(request):
    return render(request,"how_to_secure_ports.html")

def perform_malware_analysis(request):
    # path = os.path.join(settings.BASE_DIR, 'malware_detection_app/model/malwares/Locky.exe')
    # path = os.path.join(settings.BASE_DIR, 'malware_detection_app/model/malwares/samples1.exe')
    path = os.path.join(settings.BASE_DIR, 'malware_detection_app/model/malwares/rufus-4.4.exe')

    metric = analyze_metrics(path)
    result = checkFile(path)
    metric.update(result)
    print(metric)
    return HttpResponse('Results printed in the console')